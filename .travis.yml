sudo: required
language: node_js
services:
  - docker
node_js:
  - '0.10'
before_script:
  - 'npm install -g bower grunt-cli'
  - 'bower install'
  - 'gem install sass --version "=3.4.8"'
  - 'gem install compass --version "=1.0.1"'
before_deploy:
  - echo $TRAVIS_BRANCH
  - if [ "$TRAVIS_BRANCH" == 'support/1.x' ]; then export UNLEASH_ENV='production'; fi
  - if [ "$TRAVIS_BRANCH" == 'support/1.x' ]; then export BOT_URL='http://bot.unleash.x-team.com'; fi
  - if [ "$TRAVIS_BRANCH" == 'support/1.x' ]; then export PROFILES_URL='https://txkaf3ohhf.execute-api.us-west-2.amazonaws.com/prod/profiles'; fi
  - if [ "$TRAVIS_BRANCH" == 'support/1.x' ]; then export SKILLS_URL='http://skills.unleash.x-team.com/api/v1/skills'; fi
  - if [ "$TRAVIS_BRANCH" == 'support/1.x' ]; then export GOALS_URL='http://goals.unleash.x-team.com/api/v1/goals'; fi
  - if [ "$TRAVIS_BRANCH" == 'support/1.x' ]; then export PATHS_URL='http://paths.unleash.x-team.com/api/v1/paths'; fi
  - grunt build
deploy:
  - provider: script
    skip_cleanup: true
    script: ./deploy.sh latest
    on:
      tags: true
      all_branches: true
      condition: "$TRAVIS_TAG =~ ^1.*$"
  - provider: script
    skip_cleanup: true
    script: ./deploy.sh staging
    on:
      branch: develop
